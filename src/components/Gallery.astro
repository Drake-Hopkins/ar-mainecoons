---
import type { ImageMetadata } from 'astro';
import { Image } from 'astro:assets';

const modules = import.meta.glob<{ default: ImageMetadata }>(
  '../assets/*.{jpg,jpeg,png}',
  { eager: true }
);

const images = Object.values(modules)
  .map((m) => ({
    src: m.default,
    alt: m.default.src
      .split('/')
      .pop()!
      .replace(/\.(jpe?g|png)$/, '')
      .replace(/[_-]/g, ' '),
  }))
  .sort((a, b) => a.alt.localeCompare(b.alt));

const urls = images.map((i) => i.src.src);
const alts = images.map((i) => i.alt);
---

<div id="gallery" class="min-h-screen bg-neutral self-center items-center content-center snap-center text-center place-self-center place-items-center justify-items-center center align-middle mx-auto">


<section
  id="gallery"
  class="scroll-mt-16 max-w-6xl mx-auto py-8 px-4 my-10"
  data-urls={JSON.stringify(urls)}
  data-alts={JSON.stringify(alts)}
>
  <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 p-4">
    {images.map((img, idx) => (
      <div class="group cursor-pointer relative overflow-hidden">
        <Image
          src={img.src}
          alt={img.alt}
          widths={[200, 400, 800]}
          sizes="(max-width: 640px) 100vw, 25vw"
          loading="lazy"
          class="w-full h-48 object-cover rounded-lg transition-transform transform scale-100 group-hover:scale-105"
        />
        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
          <button
            class="bg-white text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors"
            data-index={idx}
          >
            View
          </button>
        </div>
      </div>
    ))}
  </div>

  <div
    id="lightbox"
    class="fixed inset-0 bg-black bg-opacity-75 hidden items-center justify-center p-4"
  >
    <div class="relative max-w-3xl w-full">
      <button
        id="lightbox-close"
        class="absolute top-2 right-2 text-white text-3xl font-bold"
        aria-label="Close"
      >
        &times;
      </button>
      <img
        id="lightbox-img"
        src=""
        alt=""
        class="w-full h-auto object-contain rounded-lg"
      />
    </div>
  </div>
</section>
</div>